<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chess vs AI</title>
<style>
body { font-family: Arial; text-align: center; background:#222; color:white; }
#board { display:grid; grid-template-columns:repeat(8,70px); width:560px; margin:20px auto; }
.square {
  width:70px; height:70px; display:flex;
  align-items:center; justify-content:center;
  font-size:42px; cursor:pointer;
}
.light { background:#f0d9b5; }
.dark { background:#b58863; }
.selected { outline:3px solid red; }
#status { margin-top:10px; }
button { padding:6px 12px; margin:5px; }
</style>
</head>
<body>

<h2>Chess vs Computer</h2>

<select id="difficulty">
  <option value="1">Easy</option>
  <option value="2">Medium</option>
  <option value="3">Hard</option>
</select>
<button onclick="resetGame()">New Game</button>

<div id="board"></div>
<div id="status"></div>

<script>
const boardEl = document.getElementById("board");
const statusEl = document.getElementById("status");
let difficulty = 1;
document.getElementById("difficulty").onchange = e => difficulty = parseInt(e.target.value);

const pieces = {
  r:'♜', n:'♞', b:'♝', q:'♛', k:'♚', p:'♟',
  R:'♖', N:'♘', B:'♗', Q:'♕', K:'♔', P:'♙'
};

let board, selected = null, turn = "white";
let enPassant = null;

function resetGame(){
  board = [
    ['r','n','b','q','k','b','n','r'],
    ['p','p','p','p','p','p','p','p'],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['P','P','P','P','P','P','P','P'],
    ['R','N','B','Q','K','B','N','R']
  ];
  turn="white";
  selected=null;
  enPassant=null;
  drawBoard();
  statusEl.innerText="Your move (White)";
}
resetGame();

function drawBoard(){
  boardEl.innerHTML="";
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      let sq=document.createElement("div");
      sq.className="square "+((r+c)%2==0?"light":"dark");
      if(selected && selected[0]==r && selected[1]==c)
        sq.classList.add("selected");
      sq.onclick=()=>handleClick(r,c);
      sq.innerText = pieces[board[r][c]] || "";
      boardEl.appendChild(sq);
    }
  }
}

function handleClick(r,c){
  if(turn!=="white") return;

  if(selected){
    let moves=getMoves(selected[0],selected[1]);
    if(moves.some(m=>m[0]==r && m[1]==c)){
      move(selected[0],selected[1],r,c);
      selected=null;
      drawBoard();
      if(!checkGameEnd()){
        turn="black";
        setTimeout(aiMove,200);
      }
      return;
    }
  }

  if(board[r][c] && board[r][c]===board[r][c].toUpperCase())
    selected=[r,c];
  drawBoard();
}

function move(fr,fc,tr,tc){
  let piece=board[fr][fc];
  board[tr][tc]=piece;
  board[fr][fc]='';

  // pawn promotion
  if(piece=='P' && tr==0) board[tr][tc]='Q';
  if(piece=='p' && tr==7) board[tr][tc]='q';
}

function getMoves(r,c){
  let piece=board[r][c];
  if(!piece) return [];
  let moves=[];
  let isWhite = piece===piece.toUpperCase();

  function add(nr,nc){
    if(nr>=0 && nr<8 && nc>=0 && nc<8){
      let target=board[nr][nc];
      if(!target || (isWhite != (target===target.toUpperCase())))
        moves.push([nr,nc]);
    }
  }

  if(piece.toLowerCase()=='p'){
    let dir=isWhite?-1:1;
    if(!board[r+dir]?.[c]) add(r+dir,c);
    if((isWhite && r==6)||( !isWhite && r==1)){
      if(!board[r+dir]?.[c] && !board[r+2*dir]?.[c])
        add(r+2*dir,c);
    }
    for(let dc of [-1,1]){
      let tr=r+dir, tc=c+dc;
      if(board[tr]?.[tc] && isWhite!=(board[tr][tc]===board[tr][tc].toUpperCase()))
        moves.push([tr,tc]);
    }
  }

  if(piece.toLowerCase()=='n'){
    [[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]]
    .forEach(d=>add(r+d[0],c+d[1]));
  }

  if(piece.toLowerCase()=='b' || piece.toLowerCase()=='q'){
    for(let d of [[1,1],[1,-1],[-1,1],[-1,-1]]){
      let nr=r+d[0], nc=c+d[1];
      while(nr>=0 && nr<8 && nc>=0 && nc<8){
        if(board[nr][nc]){
          if(isWhite!=(board[nr][nc]===board[nr][nc].toUpperCase()))
            moves.push([nr,nc]);
          break;
        }
        moves.push([nr,nc]);
        nr+=d[0]; nc+=d[1];
      }
    }
  }

  if(piece.toLowerCase()=='r' || piece.toLowerCase()=='q'){
    for(let d of [[1,0],[-1,0],[0,1],[0,-1]]){
      let nr=r+d[0], nc=c+d[1];
      while(nr>=0 && nr<8 && nc>=0 && nc<8){
        if(board[nr][nc]){
          if(isWhite!=(board[nr][nc]===board[nr][nc].toUpperCase()))
            moves.push([nr,nc]);
          break;
        }
        moves.push([nr,nc]);
        nr+=d[0]; nc+=d[1];
      }
    }
  }

  if(piece.toLowerCase()=='k'){
    for(let dr=-1;dr<=1;dr++)
      for(let dc=-1;dc<=1;dc++)
        if(dr||dc) add(r+dr,c+dc);
  }

  return moves;
}

function aiMove(){
  let best = minimaxRoot(difficulty);
  if(best){
    move(best.fr,best.fc,best.tr,best.tc);
  }
  turn="white";
  drawBoard();
  checkGameEnd();
}

function minimaxRoot(depth){
  let moves=getAllMoves(false);
  let bestScore=-Infinity, bestMove=null;
  for(let m of moves){
    let copy=JSON.parse(JSON.stringify(board));
    move(m.fr,m.fc,m.tr,m.tc);
    let score=minimax(depth-1,false);
    board=copy;
    if(score>bestScore){
      bestScore=score;
      bestMove=m;
    }
  }
  return bestMove || moves[Math.floor(Math.random()*moves.length)];
}

function minimax(depth,isMax){
  if(depth==0) return evaluate();
  let moves=getAllMoves(isMax);
  if(isMax){
    let best=-Infinity;
    for(let m of moves){
      let copy=JSON.parse(JSON.stringify(board));
      move(m.fr,m.fc,m.tr,m.tc);
      best=Math.max(best,minimax(depth-1,false));
      board=copy;
    }
    return best;
  } else {
    let best=Infinity;
    for(let m of moves){
      let copy=JSON.parse(JSON.stringify(board));
      move(m.fr,m.fc,m.tr,m.tc);
      best=Math.min(best,minimax(depth-1,true));
      board=copy;
    }
    return best;
  }
}

function getAllMoves(isWhite){
  let list=[];
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      let p=board[r][c];
      if(p && (p===p.toUpperCase())==isWhite){
        let ms=getMoves(r,c);
        ms.forEach(m=>list.push({fr:r,fc:c,tr:m[0],tc:m[1]}));
      }
    }
  }
  return list;
}

function evaluate(){
  let score=0;
  const val={p:10,n:30,b:30,r:50,q:90,k:900};
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      let p=board[r][c];
      if(p){
        let v=val[p.toLowerCase()];
        score+= (p===p.toUpperCase()) ? -v : v;
      }
    }
  }
  return score;
}

function checkGameEnd(){
  let whiteMoves=getAllMoves(true);
  let blackMoves=getAllMoves(false);
  if(whiteMoves.length==0){
    statusEl.innerText="Game Over";
    return true;
  }
  if(blackMoves.length==0){
    statusEl.innerText="You Win!";
    return true;
  }
  return false;
}
</script>
</body>
</html>